# åç«¯æ¥å£è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è§ˆ

**é¡¹ç›®åç§°**: æ˜“å®¿é…’åº—é¢„è®¢å¹³å° - API æ¥å£  
**API åŸºç¡€è·¯å¾„**: `/api`  
**æœåŠ¡ç«¯å£**: `8080`  
**è®¤è¯æ–¹å¼**: JWT Token (Bearer)

---

## ğŸ¯ å·²å®ç°æ¥å£

### 1. ç”¨æˆ·ç™»å½•

```
POST /api/user/login
```

#### è¯·æ±‚
```json
{
  "username": "admin",
  "password": "e10adc3949ba59abbe56e057f20f883e"
}
```

**å‚æ•°è¯´æ˜:**
| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|------|------|------|
| username | string | âœ“ | ç”¨æˆ·å |
| password | string | âœ“ | MD5 åŠ å¯†åçš„å¯†ç  |

#### æˆåŠŸå“åº” (200)
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userInfo": {
      "userId": 1,
      "username": "admin",
      "nickname": "ç®¡ç†å‘˜",
      "email": "admin@example.com",
      "phone": "13800138000",
      "avatar": null,
      "role": "super_admin",
      "status": "active",
      "createTime": "2026-02-05T10:00:00.000Z"
    },
    "expireTime": 7200
  }
}
```

#### é”™è¯¯å“åº”

**400 - å‚æ•°é”™è¯¯**
```json
{
  "code": 400,
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

**500 - æ•°æ®åº“æœªå¯ç”¨**
```json
{
  "code": 500,
  "message": "æ•°æ®åº“æœªå¯ç”¨ï¼Œæ— æ³•æ‰§è¡Œæ­¤æ“ä½œ",
  "data": null
}
```

---

### 2. è·å–ç”¨æˆ·ä¿¡æ¯

```
GET /api/user/info
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

#### æˆåŠŸå“åº” (200)
```json
{
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "userId": 1,
    "username": "admin",
    "nickname": "ç®¡ç†å‘˜",
    "email": "admin@example.com",
    "phone": "13800138000",
    "avatar": null,
    "role": "super_admin",
    "status": "active",
    "createTime": "2026-02-05T10:00:00.000Z"
  }
}
```

#### é”™è¯¯å“åº”

**401 - Token ç¼ºå¤±æˆ–æ— æ•ˆ**
```json
{
  "code": 401,
  "message": "Token æ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "data": null
}
```

**500 - æ•°æ®åº“æœªå¯ç”¨**
```json
{
  "code": 500,
  "message": "æ•°æ®åº“æœªå¯ç”¨ï¼Œæ— æ³•æ‰§è¡Œæ­¤æ“ä½œ",
  "data": null
}
```

---

### 3. é€€å‡ºç™»å½•

```
POST /api/user/logout
```

#### è¯·æ±‚å¤´
```
Authorization: Bearer {token}
```

#### æˆåŠŸå“åº” (200)
```json
{
  "code": 200,
  "message": "é€€å‡ºç™»å½•æˆåŠŸ",
  "data": null
}
```

#### é”™è¯¯å“åº”

**401 - Token ç¼ºå¤±æˆ–æ— æ•ˆ**
```json
{
  "code": 401,
  "message": "Token æ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "data": null
}
```

---

## ğŸ“Š ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰ API å“åº”éµå¾ªç»Ÿä¸€çš„ JSON ç»“æ„ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|
| code | number | HTTP çŠ¶æ€ç  (200/400/401/403/404/500) |
| message | string | æ“ä½œæç¤ºä¿¡æ¯ (ä¸­æ–‡) |
| data | any | ä¸šåŠ¡æ•°æ® (å¤±è´¥æ—¶ä¸º null) |

### çŠ¶æ€ç è¯´æ˜

| çŠ¶æ€ç  | å«ä¹‰ | è¯´æ˜ |
|------|------|------|
| 200 | OK | è¯·æ±‚æˆåŠŸ |
| 400 | Bad Request | å‚æ•°é”™è¯¯æˆ–ä¸šåŠ¡é€»è¾‘å¤±è´¥ |
| 401 | Unauthorized | æœªè®¤è¯æˆ– Token è¿‡æœŸ |
| 403 | Forbidden | æƒé™ä¸è¶³ |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 500 | Internal Server Error | æœåŠ¡å™¨é”™è¯¯æˆ–æ•°æ®åº“æœªå¯ç”¨ |

---

## ğŸ” è®¤è¯è¯´æ˜

### Token è·å–

1. è°ƒç”¨ `POST /api/user/login` è·å– Token
2. Token åŒ…å«åœ¨å“åº”æ•°æ®ä¸­

### Token ä½¿ç”¨

éœ€è¦è®¤è¯çš„æ¥å£ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š
```
Authorization: Bearer {token}
```

### Token æœ‰æ•ˆæœŸ

- **æœ‰æ•ˆæœŸ**: 2 å°æ—¶
- **è¿‡æœŸå**: éœ€è¦é‡æ–°ç™»å½•è·å–æ–° Token
- **å‰ç«¯å¤„ç†**: å»ºè®®ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“å­˜å‚¨ Tokenï¼Œè¿‡æœŸæ—¶æç¤ºé‡æ–°ç™»å½•

---

## ğŸ“ å¯†ç è¯´æ˜

### å‰ç«¯å¤„ç†

å¯†ç éœ€è¦ MD5 åŠ å¯†åå†å‘é€ï¼š
```javascript
import md5 from 'md5';

const encryptedPassword = md5('åŸå§‹å¯†ç ');
```

### åç«¯å¤„ç†

- æ¥æ”¶ MD5 åŠ å¯†çš„å¯†ç 
- ä½¿ç”¨ bcryptjs å†æ¬¡åŠ å¯†åä¸æ•°æ®åº“å­˜å‚¨çš„å€¼æ¯”å¯¹
- æ•°æ®åº“å­˜å‚¨çš„æ˜¯ bcrypt åŠ å¯†å€¼

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### ä½¿ç”¨ curl æµ‹è¯•

#### æµ‹è¯•ç™»å½•
```bash
curl -X POST http://localhost:8080/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"e10adc3949ba59abbe56e057f20f883e"}'
```

#### æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯
```bash
curl -X GET http://localhost:8080/api/user/info \
  -H "Authorization: Bearer {token}"
```

#### æµ‹è¯•é€€å‡ºç™»å½•
```bash
curl -X POST http://localhost:8080/api/user/logout \
  -H "Authorization: Bearer {token}"
```

### ä½¿ç”¨ Postman æµ‹è¯•

1. **åˆ›å»º Collection** "æ˜“å®¿é…’åº—é¢„è®¢å¹³å°"
2. **åˆ›å»ºç¯å¢ƒå˜é‡**:
   - `base_url`: http://localhost:8080
   - `token`: (ç™»å½•åè‡ªåŠ¨è®¾ç½®)

3. **Request - Login**
   - Method: POST
   - URL: `{{base_url}}/api/user/login`
   - Body (raw JSON):
     ```json
     {
       "username": "admin",
       "password": "e10adc3949ba59abbe56e057f20f883e"
     }
     ```
   - Tests (è‡ªåŠ¨æå– token):
     ```javascript
     var jsonData = pm.response.json();
     pm.environment.set("token", jsonData.data.token);
     ```

4. **Request - Get User Info**
   - Method: GET
   - URL: `{{base_url}}/api/user/info`
   - Headers:
     - Key: `Authorization`
     - Value: `Bearer {{token}}`

---

## ğŸš€ æ•°æ®åº“æœªå¯ç”¨æ—¶çš„è¡Œä¸º

å½“ `DB_ENABLED=false` æ—¶ï¼š

- **å¥åº·æ£€æŸ¥** (`GET /health`) - âœ… å¯ç”¨
- **ç™»å½•æ¥å£** - âŒ è¿”å›é”™è¯¯ "æ•°æ®åº“æœªå¯ç”¨"
- **è·å–ç”¨æˆ·ä¿¡æ¯** - âŒ è¿”å›é”™è¯¯ "æ•°æ®åº“æœªå¯ç”¨"
- **é€€å‡ºç™»å½•** - âœ… å¯ç”¨ (æ— éœ€æ•°æ®åº“)

---

## ğŸ“ˆ åç»­æ¥å£è§„åˆ’

### Phase 2: é…’åº—ç®¡ç† (2-3 å‘¨)
```
GET    /api/hotels              - è·å–é…’åº—åˆ—è¡¨
GET    /api/hotels/:id          - è·å–é…’åº—è¯¦æƒ…
POST   /api/hotels              - åˆ›å»ºé…’åº— (éœ€æƒé™)
PUT    /api/hotels/:id          - ç¼–è¾‘é…’åº— (éœ€æƒé™)
DELETE /api/hotels/:id          - åˆ é™¤é…’åº— (éœ€æƒé™)
```

### Phase 3: æˆ¿é—´ç®¡ç† (2-3 å‘¨)
```
GET    /api/rooms               - è·å–æˆ¿é—´åˆ—è¡¨
GET    /api/rooms/:id           - è·å–æˆ¿é—´è¯¦æƒ…
POST   /api/rooms               - åˆ›å»ºæˆ¿é—´ (éœ€æƒé™)
PUT    /api/rooms/:id           - ç¼–è¾‘æˆ¿é—´ (éœ€æƒé™)
DELETE /api/rooms/:id           - åˆ é™¤æˆ¿é—´ (éœ€æƒé™)
```

### Phase 4: é¢„è®¢ç®¡ç† (3+ å‘¨)
```
GET    /api/bookings            - è·å–é¢„è®¢åˆ—è¡¨
GET    /api/bookings/:id        - è·å–é¢„è®¢è¯¦æƒ…
POST   /api/bookings            - åˆ›å»ºé¢„è®¢
PUT    /api/bookings/:id        - ä¿®æ”¹é¢„è®¢
DELETE /api/bookings/:id        - å–æ¶ˆé¢„è®¢
```

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2026-02-05  
**ç‰ˆæœ¬**: 1.0.0
