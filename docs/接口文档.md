# 接口文档

**项目名称**：易宿酒店预订平台

**文档版本**：v1.0

**更新时间**：2026-02-11

## 一、通用说明

### 1. 基础信息

- **接口域名(未定，等待后续会议讨论)**：`https://api.xxx.com`（生产环境）；`http://test-api.xxx.com`（测试环境）

- **请求格式**：`application/json`（所有接口均需携带 JSON 格式的请求体/参数）

- **响应格式**：统一返回 `JSON`，结构如下：
  
  ```
  {  
    "code": 200,          // 状态码：200=成功，4xx=客户端错误，5xx=服务端错误  
    "message": "操作成功", // 提示信息  
    "data": {}            // 业务数据（成功时返回，失败时为 null 或空对象）  
  }
  ```

- **公共请求头**（部分接口需额外添加）：
  
  - `Authorization: Bearer {token}`：登录后需在请求头携带 token（有效期 2 小时，过期需重新登录）
  
  - `Content-Type: application/json`（默认已包含，无需重复添加）

### 2. 状态码说明

| code | 含义      | 说明                |
| ---- | ------- | ----------------- |
| 200  | 成功      | 接口调用正常，返回业务数据     |
| 400  | 参数错误    | 请求参数缺失或格式错误       |
| 401  | 未授权     | token 无效/过期，需重新登录 |
| 403  | 权限不足    | 当前用户无操作权限         |
| 404  | 资源不存在   | 请求的接口/数据不存在       |
| 500  | 服务器内部错误 | 后端服务异常，联系运维       |

## 二、接口列表

### 1. 用户登录

- **接口描述**：用户通过账号密码登录，获取登录凭证（token）

- **请求方式**：`POST`

- **接口地址**：`/api/user/login`

- **请求参数**（JSON 格式）：
  
  | 参数名      | 类型     | 是否必填 | 说明        | 示例值                                             |
  | -------- | ------ | ---- | --------- | ----------------------------------------------- |
  | username | string | 是    | 用户名/手机号   | "admin"                                         |
  | password | string | 是    | 密码（MD5加密） | "e10adc3949ba59abbe56e057f20f883e"（对应明文 123456） |

- **请求示例**：
  
  ```
  curl -X POST https://api.xxx.com/api/user/login \  
  -H "Content-Type: application/json" \  
  -d '{"username":"admin","password":"e10adc3949ba59abbe56e057f20f883e"}'
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "登录成功",  
    "data": {  
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // JWT Token  
      "userInfo": {  
        "userId": 1001,  
        "username": "admin",  
        "role": "admin", 
        "avatar": "https://xxx.com/avatar/admin.jpg"  
      },  
      "expireTime": 7200 // token 有效期（秒）  
    }  
  }
  ```

- **响应示例**（失败，密码错误）：
  
  ```
  {  
    "code": 400,  
    "message": "用户名或密码错误",  
    "data": null  
  }
  ```

### 2. 获取用户信息

- **接口描述**：登录后获取当前用户的详细信息（需携带 token）

- **请求方式**：`GET`

- **接口地址**：`/api/user/info`

- **请求头**：需携带 `Authorization: Bearer {token}`（从登录接口的 data.token 获取）

- **请求参数**：无（通过 token 识别用户身份）

- **请求示例**：
  
  ```
  curl -X GET https://api.xxx.com/api/user/info \  
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "获取成功",  
    "data": {  
      "userId": 1001,  
      "username": "admin",  
      "nickname": "管理员",  
      "email": "admin@xxx.com",  
      "phone": "13800138000",  
      "role": "admin", // 角色：admin=管理员，merchant=商户  
      "createTime": "2023-01-01 10:00:00"  
    }  
  }
  ```

- **响应示例**（失败，token 过期）：
  
  ```
  {  
    "code": 401,  
    "message": "token 已过期，请重新登录",  
    "data": null  
  }
  ```

### 3. 退出登录

- **接口描述**：销毁当前用户的 token，使登录状态失效

- **请求方式**：`POST`

- **接口地址**：`/api/user/logout`

- **请求头**：需携带 `Authorization: Bearer {token}`

- **请求参数**：无

- **请求示例**：
  
  ```
  curl -X POST https://api.xxx.com/api/user/logout \  
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "退出登录成功",  
    "data": null  
  }
  ```


### 4. 用户注册

- **接口描述**：新用户注册账号，支持设置用户名、邮箱、密码和角色

- **请求方式**：`POST`

- **接口地址**：`/api/user/register`

- **请求参数**（JSON 格式）：
  
  | 参数名      | 类型     | 是否必填 | 说明        | 示例值                                             |
  | -------- | ------ | ---- | --------- | ----------------------------------------------- |
  | username | string | 是    | 用户名（唯一）   | "zhangsan"                                       |
  | email    | string | 是    | 邮箱（唯一）    | "zhangsan@example.com"                           |
  | password | string | 是    | 密码（MD5加密） | "e10adc3949ba59abbe56e057f20f883e"（对应明文 123456） |
  | role     | string | 否    | 角色（默认merchant）| "merchant"（可选：admin/merchant）            |

- **请求示例**：
  
  ```
  curl -X POST https://api.xxx.com/api/user/register \  
  -H "Content-Type: application/json" \  
  -d '{"username":"zhangsan","email":"zhangsan@example.com","password":"e10adc3949ba59abbe56e057f20f883e","role":"user"}'
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "注册成功",  
    "data": {  
      "userId": 1002,  
      "username": "zhangsan",  
      "email": "zhangsan@example.com",  
      "role": "merchant",  
      "createTime": "2023-12-01 14:30:00"  
    }  
  }
  ```

- **响应示例**（失败，用户名已存在）：
  
  ```
  {  
    "code": 400,  
    "message": "用户名已存在",  
    "data": null  
  }
  ```

- **响应示例**（失败，邮箱已存在）：
  
  ```
  {  
    "code": 400,  
    "message": "邮箱已被注册",  
    "data": null  
  }
  ```

### 5. 发送找回密码验证码

- **接口描述**：向指定邮箱发送密码重置验证码

- **请求方式**：`POST`

- **接口地址**：`/api/user/forgot-password/send-code`

- **请求参数**（JSON 格式）：
  
  | 参数名      | 类型     | 是否必填 | 说明        | 示例值                                             |
  | -------- | ------ | ---- | --------- | ----------------------------------------------- |
  | email    | string | 是    | 注册时使用的邮箱 | "zhangsan@example.com"                           |

- **请求示例**：
  
  ```
  curl -X POST https://api.xxx.com/api/user/forgot-password/send-code \  
  -H "Content-Type: application/json" \  
  -d '{"email":"zhangsan@example.com"}'
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "验证码已发送至邮箱",  
    "data": {  
      "email": "zhangsan@example.com",  
      "expireTime": 300 // 验证码有效期（秒）  
    }  
  }
  ```

- **响应示例**（失败，邮箱未注册）：
  
  ```
  {  
    "code": 400,  
    "message": "该邮箱未注册",  
    "data": null  
  }  
  ```

### 6. 验证找回密码验证码

- **接口描述**：验证用户输入的找回密码验证码是否正确

- **请求方式**：`POST`

- **接口地址**：`/api/user/forgot-password/verify-code`

- **请求参数**（JSON 格式）：
  
  | 参数名   | 类型     | 是否必填 | 说明          | 示例值                 |
  | -------- | ------ | ---- | ----------- | ------------------- |
  | email    | string | 是    | 注册时使用的邮箱   | "zhangsan@example.com" |
  | code     | string | 是    | 邮箱收到的验证码   | "123456"               |

- **请求示例**：
  
  ```
  curl -X POST https://api.xxx.com/api/user/forgot-password/verify-code \  
  -H "Content-Type: application/json" \  
  -d '{"email":"zhangsan@example.com","code":"123456"}'
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "验证码验证成功",  
    "data": {
      "verified": true,
      "expireTime": 120 // 验证通过后的有效期（秒），在此时间内可直接重置密码
    }
  }
  ```

- **响应示例**（失败，验证码错误或已过期）：
  
  ```
  {  
    "code": 400,  
    "message": "验证码错误或已过期",  
    "data": null  
  }
  ```

- **响应示例**（失败，邮箱未注册）：
  
  ```
  {  
    "code": 400,  
    "message": "该邮箱未注册",  
    "data": null  
  }
  ```

### 7. 重置密码

- **接口描述**：使用验证码重置用户密码

- **请求方式**：`POST`

- **接口地址**：`/api/user/reset-password`

- **请求参数**（JSON 格式）：
  
  | 参数名      | 类型     | 是否必填 | 说明        | 示例值                                             |
  | -------- | ------ | ---- | --------- | ----------------------------------------------- |
  | email    | string | 是    | 注册时使用的邮箱 | "zhangsan@example.com"                           |
  | code     | string | 是    | 邮箱收到的验证码 | "123456"                                         |
  | password | string | 是    | 新密码（MD5加密）| "e10adc3949ba59abbe56e057f20f883e"（对应明文 123456） |

- **请求示例**：
  
  ```
  curl -X POST https://api.xxx.com/api/user/reset-password \  
  -H "Content-Type: application/json" \  
  -d '{"email":"zhangsan@example.com","code":"123456","password":"e10adc3949ba59abbe56e057f20f883e"}'
  ```

- **响应示例**（成功）：
  
  ```
  {  
    "code": 200,  
    "message": "密码重置成功",  
    "data": null  
  }
  ```

- **响应示例**（失败，验证码错误或已过期）：
  
  ```
  {  
    "code": 400,  
    "message": "验证码错误或已过期",  
    "data": null  
  }
  ```

- **响应示例**（失败，邮箱未注册）：
  
  ```
  {  
    "code": 400,  
    "message": "该邮箱未注册",  
    "data": null  
  }

---

## 三、酒店管理

### 1. 创建/保存酒店信息（草稿）

- **接口描述**：提交酒店基础信息、房型与价格模块，保存为草稿或直接提交审核
- **请求方式**：`POST`
- **接口地址**：`/api/hotels`
- **请求参数**（JSON 格式）：

| 参数名 | 类型 | 是否必填 | 说明 |
| --- | --- | --- | --- |
| name | string | 是 | 酒店中文名（便于列表展示） |
| description | string | 是 | 酒店英文名/简介 |
| address | string | 是 | 详细地址 |
| price | number | 是 | 起订价（用于列表展示） |
| status | string | 否 | draft/pending/approved/rejected |
| basic | object | 是 | 酒店基础信息 |
| basic.nameCn | string | 是 | 酒店中文名 |
| basic.nameEn | string | 是 | 酒店英文名 |
| basic.star | number | 是 | 星级（1-5） |
| basic.openDate | string | 是 | 开业日期（YYYY-MM-DD） |
| basic.address | string | 是 | 地址 |
| priceRange | object | 是 | 价格区间 |
| priceRange.min | number | 是 | 起订价（非负） |
| priceRange.max | number | 是 | 封顶价（非负且大于等于 min） |
| roomTypes | array | 是 | 房型列表（至少 1 条） |
| roomTypes[].name | string | 是 | 房型名称 |
| roomTypes[].bedType | string | 是 | 床型 |
| roomTypes[].area | number | 是 | 面积（m²） |
| roomTypes[].price | number | 是 | 价格（非负） |
| roomTypes[].stock | number | 是 | 可售间数 |
| nearby | object | 否 | 周边配套 |
| nearby.attractions | string[] | 否 | 景点 |
| nearby.transport | string[] | 否 | 交通枢纽 |
| nearby.mall | string[] | 否 | 商场 |
| promotions | array | 否 | 优惠策略 |
| promotions[].title | string | 是 | 标题 |
| promotions[].type | string | 是 | 类型（折扣/满减/套餐） |
| promotions[].value | number | 是 | 数值 |

- **请求示例**：

```
POST /api/hotels
{
  "name": "易宿臻选酒店",
  "description": "Ease Inn Premier",
  "address": "上海市静安区共和新路1000号",
  "price": 520,
  "status": "draft",
  "basic": {
    "nameCn": "易宿臻选酒店",
    "nameEn": "Ease Inn Premier",
    "star": 5,
    "openDate": "2022-06-18",
    "address": "上海市静安区共和新路1000号"
  },
  "priceRange": {
    "min": 520,
    "max": 1880
  },
  "roomTypes": [
    {
      "name": "豪华大床房",
      "bedType": "大床",
      "area": 42,
      "price": 880,
      "stock": 18
    }
  ],
  "nearby": {
    "attractions": ["上海自然博物馆"],
    "transport": ["地铁1号线延长路站"],
    "mall": ["大悦城"]
  },
  "promotions": [
    { "title": "节日优惠", "type": "折扣", "value": 0.8 }
  ]
}
```

- **响应示例**（成功）：

```
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "hotelId": 3001,
    "status": "draft"
  }
}
```

### 2. 编辑酒店信息

- **接口描述**：更新草稿酒店信息（含房型与价格模块）
- **请求方式**：`PUT`
- **接口地址**：`/api/hotels/{id}`
- **请求参数**：同“创建/保存酒店信息”

- **响应示例**（成功）：

```
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "hotelId": 3001
  }
}
```

### 3. 提交审核 / 更新酒店状态

- **接口描述**：草稿提交审核或更新状态
- **请求方式**：`PUT`
- **接口地址**：`/api/hotels/{id}/status`
- **请求参数**（JSON 格式）：

| 参数名 | 类型 | 是否必填 | 说明 |
| --- | --- | --- | --- |
| status | string | 是 | pending/approved/rejected |

- **响应示例**（成功）：

```
{
  "code": 200,
  "message": "状态更新成功",
  "data": {
    "hotelId": 3001,
    "status": "pending"
  }
}
```
  ```

---


**补充说明**：
1. 验证码有效期建议设置为 5 分钟（300秒）
2. 角色权限说明：
   - `admin`: 管理员
   - `merchant`: 商户

## 四、注意事项

1. 所有接口的 `Content-Type`默认为 `application/json`，请勿修改为 `form-data`或 `x-www-form-urlencoded`（除非接口特别说明）。

2. token 有效期为 2 小时，前端需在 token 过期前主动调用刷新 token 接口（若有），或引导用户重新登录。

3. 密码需在前端进行 MD5 加密后再传给后端（避免明文传输），加密规则：`MD5(原始密码)`。

4. 若接口返回 `5xx`错误，可能是后端服务异常，建议重试 1-2 次，仍失败则联系后端排查。

---

**备注**：本文档会根据后端接口变更同步更新，最新版本以 Git 仓库为准。
